<head>
<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:400,700" rel="stylesheet">
<link href='style.css' rel='stylesheet' type='text/css'>
<title>8values Results</title>
<link rel="icon" type="x-icon" href="icon.png">
<link rel="shortcut icon" type="x-icon" href="icon.png">
<meta charset="utf-8">
<script>
  version = "Test Edition #1" //Remember to update this before making changes to the test itself!
</script>
</head>
<script type="application/javascript" src="ideologies.js"></script>

<body>
<h1>PoliticAxes</h1>
<hr>
<h1>Results</h1>

<div id="axis-container"></div>

<hr/>
<h2>Closest Match: <span class="weight-300" id="ideology-label"></span></h2>
<p id="ideology-desc" style="font-style: italic; text-align: center;"></p>
<hr/>

<img src="" id="banner">
<button class="button" onclick="location.href='index.html';">Back</button>

<script>
    const axes = [
        { id: "econ",  name: "Economic", left: "Equality", right: "Markets", url: "e" },
        { id: "dipl",  name: "Diplomatic", left: "Peace", right: "Might", url: "d" },
        { id: "govt",  name: "Civil", left: "Liberty", right: "Authority", url: "g" },
        { id: "scty",  name: "Societal", left: "Progress", right: "Tradition", url: "s" },
        { id: "coll",  name: "Ownership", left: "Collectivism", right: "Individualism", url: "c" },
        { id: "env",   name: "Development", left: "Ecology", right: "Industry", url: "v" },
        { id: "dem",   name: "Decision", left: "Democracy", right: "Authority", url: "m" },
        { id: "fed",   name: "Structure", left: "Federal", right: "Unitary", url: "f" },
        { id: "rel",   name: "Truth", left: "Relativism", right: "Absolutism", url: "t" },
        { id: "ideal", name: "Vision", left: "Utopian", right: "Dystopian", url: "i" },
        { id: "util",  name: "Ethics", left: "Utilitarian", right: "Deontic", url: "x" },
        { id: "sec",   name: "Faith", left: "Secular", right: "Religious", url: "y" },
        { id: "bord",  name: "Borders", left: "Open", right: "Closed", url: "b" },
        { id: "mil",   name: "Military", left: "Pacifist", right: "Militarist", url: "p" },
        { id: "nih",   name: "Existence", left: "Nihilism", right: "Purpose", url: "n" },
        { id: "space", name: "Expansion", left: "Space", right: "Earth", url: "z" },
        { id: "meme",  name: "Culture", left: "Brain Rot", right: "Classic", url: "r" }
    ];

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if(pair[0] == variable) {return parseFloat(pair[1])}
        }
        return 50; // Default to neutral
    }

    // 1. Generate Bars HTML
    const container = document.getElementById("axis-container");
    const userStats = {};

    axes.forEach(axis => {
        const val = getQueryVariable(axis.url);
        userStats[axis.id] = val;
        
        const html = `
            <h2>${axis.name} Axis: <span class="weight-300" id="${axis.id}-label"></span></h2>
            <div class="axis">
                <div class="bar left" id="bar-left-${axis.id}" style="width:${val}%">${val}%</div>
                <div class="bar right" id="bar-right-${axis.id}" style="width:${100-val}%">${(100-val).toFixed(1)}%</div>
            </div>`;
        container.innerHTML += html;
    });

    // 2. Comprehensive 17-Axis Matching Logic
    let ideology = "";
    let ideodist = Infinity;

    for (var i = 0; i < ideologies.length; i++) {
        let dist = 0;
        axes.forEach(axis => {
            // Euclidean Distance formula
            dist += Math.pow(Math.abs(ideologies[i].stats[axis.id] - userStats[axis.id]), 2);
        });

        if (dist < ideodist) {
            ideology = ideologies[i].name;
            ideodist = dist;
        }
    }
    document.getElementById("ideology-label").innerHTML = ideology;

    // 3. Canvas Banner Generator (Adjusted for 17 axes)
    window.onload = function() {
        var c = document.createElement("canvas");
        var ctx = c.getContext("2d");
        c.width = 800;
        c.height = 1200; // Increased height for 17 axes
        ctx.fillStyle = "#EEEEEE";
        ctx.fillRect(0,0,800,1200);

        ctx.fillStyle="#222222";
        ctx.font="700 50px Montserrat";
        ctx.fillText("17Values Results", 20, 60);
        ctx.font="30px Montserrat";
        ctx.fillText("Closest Match: " + ideology, 20, 110);

        axes.forEach((axis, index) => {
            let y = 160 + (index * 60);
            let val = userStats[axis.id];
            
            // Background bar
            ctx.fillStyle="#777";
            ctx.fillRect(150, y, 500, 30);
            
            // Value bar
            ctx.fillStyle="#f44336"; // Left color
            ctx.fillRect(150, y, 5 * val, 30);
            
            ctx.fillStyle="#222";
            ctx.font="700 15px Montserrat";
            ctx.textAlign="right";
            ctx.fillText(axis.left, 140, y + 20);
            ctx.textAlign="left";
            ctx.fillText(axis.right, 660, y + 20);
        });

        document.getElementById("banner").src = c.toDataURL();
    }
</script>
