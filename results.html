<head>
<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:400,700" rel="stylesheet">
<link href='style.css' rel='stylesheet' type='text/css'>
<title>PoliticAxes Results</title>
<link rel="icon" type="x-icon" href="icon.png">
<link rel="shortcut icon" type="x-icon" href="icon.png">
<meta charset="utf-8">
<script>
  version = "Test Edition #1" //Remember to update this before making changes to the test itself!
</script>
</head>
<script type="application/javascript" src="ideologies.js"></script>

<body>
<h1>PoliticAxes</h1>
<hr>
<h1>Results</h1>

<div id="axis-container"></div>

<hr/>
<h2>Closest Match: <span class="weight-300" id="ideology-label"></span></h2>
<p style="text-align: center; color: #777; font-style: italic;">(Ideology matching feature coming soon!)</p>
<p id="ideology-desc" style="font-style: italic; text-align: center;"></p>
<hr/>

<img src="" id="banner">
<button class="button" onclick="location.href='index.html';">Back</button>

<script>
const axes = [
    // --- ECONOMIC ---
    { id: "econ", name: "Economic", left: "Equality", right: "Markets", url: "e", color: "#f44336", tiers: ["Communist", "Socialist", "Mixed", "Capitalist", "Laissez-Faire"] },
    { id: "coll", name: "Ownership", left: "Collective", right: "Private", url: "c", color: "#3f51b5", tiers: ["Public Only", "Socialized", "Cooperative", "Private-Leaning", "Purely Private"] },
    { id: "plan", name: "Planning", left: "Planned", right: "Laissez-Faire", url: "l", color: "#795548", tiers: ["Centrally Planned", "Dirigiste", "Regulated", "Decentralized", "Unregulated"] },
    { id: "env",  name: "Development", left: "Ecology", right: "Industry", url: "v", color: "#4caf50", tiers: ["Deep Ecology", "Green", "Sustainable", "Productivist", "Industrialist"] },

    // --- STATE ---
    { id: "govt", name: "Civil", left: "Liberty", right: "Authority", url: "g", color: "#ff9800", tiers: ["Anarchist", "Libertarian", "Moderate", "Statist", "Totalitarian"] },
    { id: "dem",  name: "Decision", left: "Democracy", right: "Autocratic", url: "m", color: "#00bcd4", tiers: ["Direct Democracy", "Representative", "Hybrid", "Authoritarian", "Autocratic"] },
    { id: "fed",  name: "Structure", left: "Federal", right: "Unitary", url: "f", color: "#607d8b", tiers: ["Confederal", "Federal", "Regionalist", "Centralized", "Unitary"] },

    // --- DIPLOMATIC ---
    { id: "dipl", name: "Worldview", left: "Nationalist", right: "Globalist", url: "w", color: "#00897b", tiers: ["Ultranationalist", "Nationalist", "Patriotic", "Internationalist", "Globalist"] },
    { id: "mil",  name: "Military", left: "Pacifist", right: "Militarist", url: "p", color: "#b71c1c", tiers: ["Pacifist", "Anti-War", "Balanced", "Hawkish", "Militarist"] },
    { id: "bord", name: "Borders", left: "Open", right: "Closed", url: "b", color: "#2196f3", tiers: ["Borderless", "Open", "Regulated", "Restrictive", "Fortress"] },
    { id: "space",name: "Expansion", left: "Earth", right: "Space", url: "z", color: "#1a237e", tiers: ["Terrestrial", "Earth-First", "Neutral", "Space-Leaning", "Off-World"] },

    // --- PHILOSOPHY & CULTURE ---
    { id: "scty", name: "Societal", left: "Progress", right: "Tradition", url: "s", color: "#9c27b0", tiers: ["Revolutionary", "Progressive", "Reformist", "Traditionalist", "Reactionary"] },
    { id: "sec",  name: "Faith", left: "Secular", right: "Religious", url: "y", color: "#fb8c00", tiers: ["Atheist", "Secular", "Agnostic", "Spiritual", "Theocratic"] },
    { id: "Clt",  name: "Culturalism", left: "Assimilation", right: "Multicultural", url: "a", color: "#d4e157", tiers: ["Monocultural", "Assimilationist", "Pluralist", "Multicultural", "Intercultural"] },
    { id: "util", name: "Ethics", left: "Utilitarian", right: "Deontic", url: "x", color: "#827717", tiers: ["Purely Utilitarian", "Consequentialist", "Pragmatic", "Rule-Based", "Deontological"] },
    { id: "rel",  name: "Truth", left: "Relativism", right: "Absolutism", url: "t", color: "#455a64", tiers: ["Nihilistic", "Relativist", "Skeptic", "Objectivist", "Absolutist"] },
    { id: "ideal",name: "Vision", left: "Utopian", right: "Dystopian", url: "i", color: "#e91e63", tiers: ["Utopian", "Idealist", "Realist", "Cynical", "Dystopian"] },
    { id: "nih",  name: "Existence", left: "Nihilism", right: "Purpose", url: "n", color: "#212121", tiers: ["Absurdist", "Nihilist", "Existentialist", "Stoic", "Teleological"] },
    { id: "meme", name: "Culture", left: "Brain Rot", right: "Classic", url: "r", color: "#ffeb3b", tiers: ["Post-Irony", "Brain Rot", "Irony", "Modern", "Classic"] }
];
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if(pair[0] == variable) {return parseFloat(pair[1])}
        }
        return 50; // Default to neutral
    }

    // 1. Generate Bars HTML
    const container = document.getElementById("axis-container");
const userStats = {};

axes.forEach(axis => {
    const val = getQueryVariable(axis.url);
    userStats[axis.id] = val;
    
    // Calculate which tier label to show (0-100 divided into 5 chunks)
    const tierIndex = Math.min(Math.floor(val / 20), 4);
    const statusLabel = axis.tiers[tierIndex];

    const html = `
        <div class="axis-card" style="margin-bottom: 30px;">
            <h2 style="text-align:left; margin-bottom:5px;">
                ${axis.name}: <span class="weight-300" style="color:${axis.color}">${statusLabel}</span>
            </h2>
            <div class="axis" style="border: 2px solid #222; height: 35px; border-radius: 20px; overflow: hidden; display: flex; background-color: #ddd;">
                <div class="bar left" style="width:${val}%; background-color:${axis.color}; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                    ${val}%
                </div>
                <div class="bar right" style="width:${100-val}%; display: flex; align-items: center; justify-content: center; color: #444; font-weight: bold;">
                    ${(100-val).toFixed(1)}%
                </div>
            </div>
            <div class="axis-labels" style="display: flex; justify-content: space-between; font-weight: bold; padding-top: 5px;">
                <span>${axis.left}</span>
                <span>${axis.right}</span>
            </div>
        </div>`;
    container.innerHTML += html;
});

    // 2. Comprehensive 17-Axis Matching Logic (Improved)
    let ideology = "";
    let ideodist = Infinity;

    for (var i = 0; i < ideologies.length; i++) {
        let dist = 0;
        axes.forEach(axis => {
            // Calculate how far the user is from this ideology
            dist += Math.pow(Math.abs(ideologies[i].stats[axis.id] - userStats[axis.id]), 2);
        });

        // TIE-BREAKER: We add a "penalty" to Syncretism. 
        // This makes the code prefer a specific ideology even if it's slightly "further" away.
        let adjustedDist = (ideologies[i].name === "Syncretism") ? dist + 1000 : dist;

        if (adjustedDist < ideodist) {
            ideology = ideologies[i].name;
            ideodist = adjustedDist;
        }
    }
    document.getElementById("ideology-label").innerHTML = ideology;

    // 3. Canvas Banner Generator (Adjusted for 17 axes)
    window.onload = function() {
        var c = document.createElement("canvas");
        var ctx = c.getContext("2d");
        c.width = 800;
        c.height = 1200; // Increased height for 17 axes
        ctx.fillStyle = "#EEEEEE";
        ctx.fillRect(0,0,800,1200);

        ctx.fillStyle="#222222";
        ctx.font="700 50px Montserrat";
        ctx.fillText("17Values Results", 20, 60);
        ctx.font="30px Montserrat";
        ctx.fillText("Closest Match: " + ideology, 20, 110);

        axes.forEach((axis, index) => {
    let y = 160 + (index * 60);
    let val = userStats[axis.id];
    
    // Background bar
    ctx.fillStyle="#ddd";
    ctx.fillRect(150, y, 500, 30);
    
    // Value bar using the new specific colors
    ctx.fillStyle = axis.color; 
    ctx.fillRect(150, y, 5 * val, 30);
    
    // Labels...
    ctx.fillStyle="#222";
    ctx.font="700 15px Montserrat";
    ctx.textAlign="right";
    ctx.fillText(axis.left, 140, y + 20);
    ctx.textAlign="left";
    ctx.fillText(axis.right, 660, y + 20);
});
</script>
